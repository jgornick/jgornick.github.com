<!doctype html>

<html lang="en-us">

<head>
  <title>Joe Gornick</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="The HTML5 Herald" />
  <meta name="author" content="Joe Gornick" />
  <meta name="generator" content="Hugo 0.55.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css" />
<link rel="stylesheet" type="text/css" href="https://joegornick.com/css/styles.css" />
</head>

<body>
  <div id="container" class="markdown-body">
    <header>
      <h1>
        <a href="https://joegornick.com/">Joe Gornick</a>
      </h1>

      <ul id="social-media">
        
        <li><a href="https://twitter.com/jgornick"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
         
        <li><a href="https://www.linkedin.com/in/jgornick"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
         
        <li><a href="https://github.com/jgornick"><i class="fa fa-github fa-lg" aria-hidden="true"></i></a></li>
         
        <li><a href="https://gitlab.com/jgornick"><i class="fa fa-gitlab fa-lg" aria-hidden="true"></i></a></li>
          
      </ul>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="https://joegornick.com/posts/">
                <i class="fa-li fa  fa-lg"></i><span>Posts</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://joegornick.com/resume/">
                <i class="fa-li fa  fa-lg"></i><span>Resume</span>
            </a>
        </li>
        
    </ul>
</nav>

    <main>




<article>

    <h1>Zend Framework Best Practices – Part 1: Getting Started</h1>

    
        <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2009-11-18T23:19:00-05:00">Nov 18, 2009</time>
        </li>
        
        

        

        <li>8 min read</li>
    </ul>
</aside>
    

    <p>Welcome to part one of my Zend Framework Best Practices series. When I started using Zend Framework a little over two years ago, I found it very difficult to find definitive methods to use when building your application. However, after the release of Zend Framework 1.8, books like <a href="http://www.zendframeworkinaction.com/">Zend Framework in Action</a>, more community involvement and of course my own experiences, I feel that I&rsquo;ve found a simple, clean and efficient way to make your application.</p>

<p>This series will cover many areas of a website including directory structure, bootstrapping, caching, navigation, ACL &amp; authorization and I18N.</p>

<p>Disclaimer: I don&rsquo;t want this series to be taken as the &ldquo;only way&rdquo; to use Zend Framework in your application. In fact, it would be greatly appreciated if others are able to point out areas where my approach is not the most efficient and provide ways to fix it.</p>

<!-- more -->

<p>Ok, let&rsquo;s start&hellip;</p>

<p>I would first like to discuss the directory structure of a Zend Framework application. This is always a hot topic in #zftalk. There are two documents out on the ZF wiki which discuss a directory structure to choose. First, there was <a href="http://framework.zend.com/wiki/display/ZFDEV/Choosing+Your+Application%27s+Directory+Layout" title="Choosing Your Application's Directory Layout">Choosing Your Application&rsquo;s Directory Layout</a> which has now been deprecated by <a href="http://framework.zend.com/wiki/display/ZFPROP/Zend+Framework+Default+Project+Structure+-+Wil+Sinclair">Zend Framework Default Project Structure by Wil Sinclair.</a> The latter of the two is very close to what was adopted by <code>Zend_Tool</code>.</p>

<p>This is really a personal preference, but I wanted to share my directory structure. It is very similar to latest proposed version, only I use the more &ldquo;classical (unix/linux)&rdquo; style.</p>

<p>Here&rsquo;s an example of my initial directory structure and basic files needed:</p>

<pre><code>project/
    app/
        configs/
            application.ini
        controllers/
            helpers/
            ErrorController.php
            IndexController.php
        data/
            cache/
            i18n/
            sessions/
        forms/
        layouts/
            scripts/
                layout.phtml
        models/
        views/
            helpers/
                AssetUrl.php
            scripts/
                error/
                    error.phtml
                index/
                    index.phtml
        Bootstrap.php
    lib/
        My/
            Application.php
        Zend/
    www/
        css/
            reset.css
        img/
        js/
        .htaccess
        index.
</code></pre>

<p>Now that you can visually see the directory structure, let&rsquo;s go through setting up our application.</p>

<p>The <code>.htaccess</code> file is used with Apache and <code>mod_rewrite</code> to either load the file requested or pass the request to the <code>index.php</code> file.</p>

<p>.htaccess:</p>

<pre><code>SetEnv APPLICATION_ENV development
&amp;nbsp;
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} \.(js|css|gif|jpg|png|swf)$ [OR]
RewriteCond %{REQUEST_FILENAME} -s [OR]
RewriteCond %{REQUEST_FILENAME} -l [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^.*$ - [NC,L]
RewriteRule ^.*$ index.php [NC,L]
</code></pre>

<p>If you notice on the first line, we set an environment variable, <code>APPLICATION_ENV</code>, to the value of <code>development</code>. This is used in the <code>index.php</code> to tell our bootstrap what environment we should setup for. The value can be any environment name, however, you need to make sure you configuration recognizes it. Some standard names are <code>development</code>, <code>staging</code>, <code>beta</code> and <code>production</code>. Please note though, on shared hosting plans, the <code>SetEnv</code> directive will probably not work since <code>mod_env</code> won&rsquo;t be installed. If this is the case, then you will need to set the environment in the <code>index.php</code> file.</p>

<p>Our rewrite conditions simply say, if the request isn&rsquo;t an asset and/or found on the file system, then redirect the request to our <code>index.php</code>.</p>

<p>The <code>index.php</code> file is used to initialize our application and setup the environment.</p>

<p>index.php:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
    <span style="color:#75715e">// Define path to application directory
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">defined</span>(<span style="color:#e6db74">&#39;APPLICATION_PATH&#39;</span>))
        <span style="color:#a6e22e">define</span>(<span style="color:#e6db74">&#39;APPLICATION_PATH&#39;</span>, <span style="color:#a6e22e">realpath</span>(<span style="color:#a6e22e">dirname</span>(<span style="color:#66d9ef">__FILE__</span>) <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/../app&#39;</span>));

    <span style="color:#75715e">// Define application environment
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">defined</span>(<span style="color:#e6db74">&#39;APPLICATION_ENV&#39;</span>))
        <span style="color:#a6e22e">define</span>(<span style="color:#e6db74">&#39;APPLICATION_ENV&#39;</span>,
            (<span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#39;APPLICATION_ENV&#39;</span>) <span style="color:#f92672">?</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#39;APPLICATION_ENV&#39;</span>) <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;production&#39;</span>));

    <span style="color:#75715e">// Add our lib folder to the include paths
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">set_include_path</span>(<span style="color:#a6e22e">implode</span>(<span style="color:#a6e22e">PATH_SEPARATOR</span>, <span style="color:#66d9ef">array</span>(
            <span style="color:#a6e22e">realpath</span>(<span style="color:#a6e22e">APPLICATION_PATH</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/../lib&#39;</span>),
            <span style="color:#a6e22e">get_include_path</span>()
    )));

    <span style="color:#e6db74">/** My_Application */</span>
    <span style="color:#66d9ef">require_once</span> <span style="color:#e6db74">&#39;My/Application.php&#39;</span>;

    <span style="color:#75715e">// Create application, bootstrap, and run
</span><span style="color:#75715e"></span>    $application <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">My_Application</span>(
        <span style="color:#a6e22e">APPLICATION_ENV</span>,
        <span style="color:#66d9ef">array</span>(
            <span style="color:#e6db74">&#39;configFile&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">APPLICATION_PATH</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/configs/application.ini&#39;</span>
        )
    );
    $application<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">bootstrap</span>()<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">run</span>();
</code></pre></div>
<p>Our <code>index.php</code> does a few things before we bootstrap our application. First, you will notice it defines a constant for our application path. Then, it does the same thing for our application environment constant. Please note, that if the <code>SetEnv</code> does not work or the <code>APPLICATION_ENV</code> isn&rsquo;t defined, then it will default to production. You can change that value to whatever environment you&rsquo;d like to default to.</p>

<p>Once our constants are setup, we then add our <code>lib</code> directory to the include path.</p>

<p>Now it&rsquo;s time to bootstrap our application. If you notice, we are using a custom class called <code>My_Application</code> which extends <code>Zend_Application</code>. This class is used to bootstrap our application while caching our <code>application.ini</code> configuration. We cache our configuration because parsing an INI file is very slow in PHP. This allows us to cache the already parsed INI as a <code>Zend_Config</code> object.</p>

<p>My/Application.php</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
    <span style="color:#66d9ef">require_once</span> <span style="color:#e6db74">&#39;Zend/Application.php&#39;</span>;
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">My_Application</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Zend_Application</span>
    {
        <span style="color:#e6db74">/**
</span><span style="color:#e6db74">         * Flag used when determining if we should cache our configuration.
</span><span style="color:#e6db74">         */</span>
        <span style="color:#66d9ef">protected</span> $_cacheConfig <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;

        <span style="color:#e6db74">/**
</span><span style="color:#e6db74">         * Our default options which will use File caching
</span><span style="color:#e6db74">         */</span>
        <span style="color:#66d9ef">protected</span> $_cacheOptions <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(
            <span style="color:#e6db74">&#39;frontendType&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;File&#39;</span>,
            <span style="color:#e6db74">&#39;backendType&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;File&#39;</span>,
            <span style="color:#e6db74">&#39;frontendOptions&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(),
            <span style="color:#e6db74">&#39;backendOptions&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>()
        );

        <span style="color:#e6db74">/**
</span><span style="color:#e6db74">         * Constructor
</span><span style="color:#e6db74">         *
</span><span style="color:#e6db74">         * Initialize application. Potentially initializes include_paths, PHP
</span><span style="color:#e6db74">         * settings, and bootstrap class.
</span><span style="color:#e6db74">         *
</span><span style="color:#e6db74">         * When $options is an array with a key of configFile, this will tell the
</span><span style="color:#e6db74">         * class to cache the configuration using the default options or cacheOptions
</span><span style="color:#e6db74">         * passed in.
</span><span style="color:#e6db74">         *
</span><span style="color:#e6db74">         * @param  string                   $environment
</span><span style="color:#e6db74">         * @param  string|array|Zend_Config $options String path to configuration file, or array/Zend_Config of configuration options
</span><span style="color:#e6db74">         * @throws Zend_Application_Exception When invalid options are provided
</span><span style="color:#e6db74">         * @return void
</span><span style="color:#e6db74">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __construct($environment, $options <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>)
        {
            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is_array</span>($options) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isset</span>($options[<span style="color:#e6db74">&#39;configFile&#39;</span>])) {
                $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">_cacheConfig</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;

                <span style="color:#75715e">// First, let&#39;s check to see if there are any cache options
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($options[<span style="color:#e6db74">&#39;cacheOptions&#39;</span>]))
                    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">_cacheOptions</span> <span style="color:#f92672">=</span>
                        <span style="color:#a6e22e">array_merge</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">_cacheOptions</span>, $options[<span style="color:#e6db74">&#39;cacheOptions&#39;</span>]);

                $options <span style="color:#f92672">=</span> $options[<span style="color:#e6db74">&#39;configFile&#39;</span>];
            }
            <span style="color:#66d9ef">parent</span><span style="color:#f92672">::</span><span style="color:#a6e22e">__construct</span>($environment, $options);
        }

        <span style="color:#e6db74">/**
</span><span style="color:#e6db74">         * Load configuration file of options.
</span><span style="color:#e6db74">         *
</span><span style="color:#e6db74">         * Optionally will cache the configuration.
</span><span style="color:#e6db74">         *
</span><span style="color:#e6db74">         * @param  string $file
</span><span style="color:#e6db74">         * @throws Zend_Application_Exception When invalid configuration file is provided
</span><span style="color:#e6db74">         * @return array
</span><span style="color:#e6db74">         */</span>
        <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_loadConfig</span>($file)
        {
            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">_cacheConfig</span>)
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">parent</span><span style="color:#f92672">::</span><span style="color:#a6e22e">_loadConfig</span>($file);

            <span style="color:#66d9ef">require_once</span> <span style="color:#e6db74">&#39;Zend/Cache.php&#39;</span>;
            $cache <span style="color:#f92672">=</span> <span style="color:#a6e22e">Zend_Cache</span><span style="color:#f92672">::</span><span style="color:#a6e22e">factory</span>(
                $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">_cacheOptions</span>[<span style="color:#e6db74">&#39;frontendType&#39;</span>],
                $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">_cacheOptions</span>[<span style="color:#e6db74">&#39;backendType&#39;</span>],
                <span style="color:#a6e22e">array_merge</span>(<span style="color:#66d9ef">array</span>( <span style="color:#75715e">// Frontend Default Options
</span><span style="color:#75715e"></span>                    <span style="color:#e6db74">&#39;master_file&#39;</span> <span style="color:#f92672">=&gt;</span> $file,
                    <span style="color:#e6db74">&#39;automatic_serialization&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>
                ), $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">_cacheOptions</span>[<span style="color:#e6db74">&#39;frontendOptions&#39;</span>]),
                <span style="color:#a6e22e">array_merge</span>(<span style="color:#66d9ef">array</span>( <span style="color:#75715e">// Backend Default Options
</span><span style="color:#75715e"></span>                    <span style="color:#e6db74">&#39;cache_dir&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">APPLICATION_PATH</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/data/cache&#39;</span>
                ), $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">_cacheOptions</span>[<span style="color:#e6db74">&#39;backendOptions&#39;</span>])
            );

            $config <span style="color:#f92672">=</span> $cache<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">load</span>(<span style="color:#e6db74">&#39;Zend_Application_Config&#39;</span>);
            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$config) {
                $config <span style="color:#f92672">=</span> <span style="color:#66d9ef">parent</span><span style="color:#f92672">::</span><span style="color:#a6e22e">_loadConfig</span>($file);
                $cache<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">save</span>($config, <span style="color:#e6db74">&#39;Zend_Application_Config&#39;</span>);
            }

            <span style="color:#66d9ef">return</span> $config;
        }
    }
</code></pre></div>
<p>application.ini:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[production]</span>

<span style="color:#75715e"># Debug output</span>
<span style="color:#a6e22e">phpSettings.display_startup_errors</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">0</span>
<span style="color:#a6e22e">phpSettings.display_errors</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">0</span>

<span style="color:#75715e"># PHP Date Settings</span>
<span style="color:#a6e22e">phpSettings.date.timezone</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;UTC&#34;</span>

<span style="color:#75715e"># Include path</span>
<span style="color:#a6e22e">includePaths.library</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">APPLICATION_PATH &#34;/../lib&#34;</span>

<span style="color:#75715e"># Autoloader Namespaces</span>
<span style="color:#a6e22e">autoloaderNamespaces[]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;My_&#34;</span>

<span style="color:#75715e"># Bootstrap</span>
<span style="color:#a6e22e">bootstrap.path</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">APPLICATION_PATH &#34;/Bootstrap.php&#34;</span>
<span style="color:#a6e22e">bootstrap.class</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Bootstrap&#34;</span>

<span style="color:#75715e"># Front Controller</span>
<span style="color:#a6e22e">resources.frontController.controllerDirectory</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">APPLICATION_PATH &#34;/controllers&#34;</span>

<span style="color:#75715e"># Front Controller Params</span>
<span style="color:#a6e22e">resources.frontController.params.env</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">APPLICATION_ENV</span>
<span style="color:#a6e22e">resources.frontController.params.cdnEnabled</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;true&#34;</span>
<span style="color:#a6e22e">resources.frontController.params.cdnHost</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://static.site.com&#34;</span>

<span style="color:#75715e"># Layout</span>
<span style="color:#a6e22e">resources.layout.layout</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;layout&#34;</span>
<span style="color:#a6e22e">resources.layout.layoutPath</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">APPLICATION_PATH &#34;/layouts/scripts&#34;</span>

<span style="color:#75715e"># Views</span>
<span style="color:#a6e22e">resources.view.encoding</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;UTF-8&#34;</span>
<span style="color:#a6e22e">resources.view.basePath</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">APPLICATION_PATH &#34;/views/scripts&#34;</span>

<span style="color:#75715e"># Database</span>
<span style="color:#a6e22e">resources.db.adapter</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mysqli&#34;</span>
<span style="color:#a6e22e">resources.db.params.host</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;localhost&#34;</span>
<span style="color:#a6e22e">resources.db.params.username</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;user&#34;</span>
<span style="color:#a6e22e">resources.db.params.password</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;password&#34;</span>
<span style="color:#a6e22e">resources.db.params.dbname</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dbname&#34;</span>
<span style="color:#a6e22e">resources.db.isDefaultTableAdapter</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">true</span>

<span style="color:#75715e"># Session</span>
<span style="color:#a6e22e">resources.session.save_path</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">APPLICATION_PATH &#34;/data/sessions&#34;</span>
<span style="color:#a6e22e">resources.session.gc_maxlifetime</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">18000</span>
<span style="color:#a6e22e">resources.session.remember_me_seconds</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">18000</span>

<span style="color:#75715e"># Navigation</span>
<span style="color:#a6e22e">resources.navigation.storage.registry.key</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Zend_Navigation&#34;</span>
<span style="color:#a6e22e">resources.navigation.pages.welcome.label</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Welcome&#34;</span>
<span style="color:#a6e22e">resources.navigation.pages.welcome.uri</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/&#34;</span>

<span style="color:#66d9ef">[development : production]</span>

<span style="color:#75715e"># Debug output</span>
<span style="color:#a6e22e">phpSettings.display_startup_errors</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">1</span>
<span style="color:#a6e22e">phpSettings.display_errors</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">1</span>

<span style="color:#75715e"># Front Controller Params</span>
<span style="color:#a6e22e">resources.frontController.params.cdnEnabled</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;false&#34;</span>

<span style="color:#75715e"># Database</span>
<span style="color:#a6e22e">resources.db.params.dbname</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dbname&#34;</span></code></pre></div>
<p>A couple of notes about the configuration file:</p>

<ul>
<li>Automatically set dates to UTC</li>
<li>Automatically load classes that start with <code>My_</code> from our lib directory</li>
<li>Pass our environment to the front controller parameters</li>
<li>Set our sessions to expire after 4 hours (when used)</li>
<li>Automatically store our navigation in the registry with key <code>Zend_Navigation</code></li>
<li>The <code>resources.frontController.params.cdnEnabled</code> setting will be explained in greater detail when I discuss caching and CDN fronting your assets</li>
</ul>

<p>Since our application configuration has been loaded and cached, it&rsquo;s time to run our bootstrap.</p>

<p>Our <code>Bootstrap.php</code> extends from the <code>Zend_Application_Bootstrap_Bootstrap</code> class. Whenever you want to initialize resources, you need to create a protected function in our bootstrap prefixed like <code>protected function _init{Resource}() { ... }</code>.</p>

<p>Bootstrap.php:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Bootstrap</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Zend_Application_Bootstrap_Bootstrap</span>
    {
        <span style="color:#e6db74">/**
</span><span style="color:#e6db74">         * Automatically load classes that are part of the default module.
</span><span style="color:#e6db74">         */</span>
        <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_initModuleAutoloader</span>()
        {
            <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zend_Application_Module_Autoloader</span>(<span style="color:#66d9ef">array</span>(
                <span style="color:#e6db74">&#39;namespace&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;Default&#39;</span>,
                <span style="color:#e6db74">&#39;basePath&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">APPLICATION_PATH</span>
            ));
        }

        <span style="color:#e6db74">/**
</span><span style="color:#e6db74">         * Initialize our routes.
</span><span style="color:#e6db74">         */</span>
        <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_initRoutes</span>()
        {
            $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">bootstrap</span>(<span style="color:#e6db74">&#39;frontcontroller&#39;</span>);
            $front <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getResource</span>(<span style="color:#e6db74">&#39;frontcontroller&#39;</span>);

            $router <span style="color:#f92672">=</span> $front<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getRouter</span>();
            $router<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">addRoute</span>(<span style="color:#e6db74">&#39;index-action&#39;</span>, <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zend_Controller_Router_Route</span>(
                <span style="color:#e6db74">&#39;:action/*&#39;</span>,
                <span style="color:#66d9ef">array</span>(
                    <span style="color:#e6db74">&#39;controller&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;index&#39;</span>,
                    <span style="color:#e6db74">&#39;action&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;index&#39;</span>
                )
            ));

            <span style="color:#66d9ef">return</span> $router;
        }

        <span style="color:#e6db74">/**
</span><span style="color:#e6db74">         * Get our database adapter and add it to our registry for easy access
</span><span style="color:#e6db74">         * throughout the application.
</span><span style="color:#e6db74">         */</span>
        <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_initDbAdapter</span>()
        {
            $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">bootstrap</span>(<span style="color:#e6db74">&#39;db&#39;</span>);
            $db <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getPluginResource</span>(<span style="color:#e6db74">&#39;db&#39;</span>);

            <span style="color:#a6e22e">Zend_Registry</span><span style="color:#f92672">::</span><span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;db&#39;</span>, $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getDbAdapter</span>());
        }

        <span style="color:#e6db74">/**
</span><span style="color:#e6db74">         * Initialize our view and add it to the ViewRenderer action helper.
</span><span style="color:#e6db74">         */</span>
        <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_initView</span>()
        {
            <span style="color:#75715e">// Initialize view
</span><span style="color:#75715e"></span>            $view <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zend_View</span>();

            <span style="color:#75715e">// Add it to the ViewRenderer
</span><span style="color:#75715e"></span>            $viewRenderer <span style="color:#f92672">=</span>
                <span style="color:#a6e22e">Zend_Controller_Action_HelperBroker</span><span style="color:#f92672">::</span><span style="color:#a6e22e">getStaticHelper</span>(<span style="color:#e6db74">&#39;ViewRenderer&#39;</span>);
            $viewRenderer<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setView</span>($view);

            <span style="color:#75715e">// Return it, so that it can be stored by the bootstrap
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> $view;
        }

        <span style="color:#e6db74">/**
</span><span style="color:#e6db74">         * Here we will initialize any view helpers.    This will also setup basic
</span><span style="color:#e6db74">         * head information for the view/layout.
</span><span style="color:#e6db74">         */</span>
        <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_initViewHelpers</span>()
        {
            $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">bootstrap</span>(<span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;frontcontroller&#39;</span>, <span style="color:#e6db74">&#39;view&#39;</span>));
            $frontController <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getResource</span>(<span style="color:#e6db74">&#39;frontcontroller&#39;</span>);
            $view <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getResource</span>(<span style="color:#e6db74">&#39;view&#39;</span>);

            <span style="color:#75715e">// Add helper paths.
</span><span style="color:#75715e"></span>            $view<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">addHelperPath</span>(<span style="color:#a6e22e">APPLICATION_PATH</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/views/helpers&#39;</span>, <span style="color:#e6db74">&#39;Default_View_Helper&#39;</span>);

            <span style="color:#75715e">// Setup our AssetUrl View Helper
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> ((<span style="color:#a6e22e">bool</span>) $frontController<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getParam</span>(<span style="color:#e6db74">&#39;cdnEnabled&#39;</span>))
                $view<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getHelper</span>(<span style="color:#e6db74">&#39;AssetUrl&#39;</span>)<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setBaseUrl</span>($frontController<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getParam</span>(<span style="color:#e6db74">&#39;cdnHost&#39;</span>));

            <span style="color:#75715e">// Set our DOCTYPE
</span><span style="color:#75715e"></span>            $view<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">doctype</span>(<span style="color:#e6db74">&#39;XHTML1_STRICT&#39;</span>);

            <span style="color:#75715e">// Set our TITLE
</span><span style="color:#75715e"></span>            $view<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">headTitle</span>()<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setSeparator</span>(<span style="color:#e6db74">&#39; - &#39;</span>)<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;Site&#39;</span>);

            <span style="color:#75715e">// Add any META elements
</span><span style="color:#75715e"></span>            $view<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">headMeta</span>()<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">appendHttpEquiv</span>(<span style="color:#e6db74">&#39;Content-Type&#39;</span>, <span style="color:#e6db74">&#39;text/html; charset=UTF-8&#39;</span>);
            $view<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">headMeta</span>()<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">appendHttpEquiv</span>(<span style="color:#e6db74">&#39;Content-Style-Type&#39;</span>, <span style="color:#e6db74">&#39;text/css&#39;</span>);
            $view<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">headMeta</span>()<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">appendHttpEquiv</span>(<span style="color:#e6db74">&#39;imagetoolbar&#39;</span>, <span style="color:#e6db74">&#39;no&#39;</span>);

            <span style="color:#75715e">// Add our favicon
</span><span style="color:#75715e"></span>            $view<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">headLink</span>()<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">headLink</span>(<span style="color:#66d9ef">array</span>(
                <span style="color:#e6db74">&#39;rel&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;favicon&#39;</span>,
                <span style="color:#e6db74">&#39;type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;image/ico&#39;</span>,
                <span style="color:#e6db74">&#39;href&#39;</span> <span style="color:#f92672">=&gt;</span> $view<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">baseUrl</span>(<span style="color:#e6db74">&#39;favicon.ico&#39;</span>)
            ));

            <span style="color:#75715e">// Add Stylesheet&#39;s
</span><span style="color:#75715e"></span>            $view<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">headLink</span>()
                <span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">appendStylesheet</span>($view<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">assetUrl</span>(<span style="color:#e6db74">&#39;css/reset.css&#39;</span>));

            <span style="color:#75715e">// Add JavaScript&#39;s
</span><span style="color:#75715e"></span>            $view<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">headScript</span>()
                <span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">appendFile</span>(<span style="color:#e6db74">&#39;http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js&#39;</span>);
        }
    }
</code></pre></div>
<p>A few things to take note in our <code>Bootstrap.php</code>:</p>

<ul>
<li>We setup a default route that allows the user to load an action like <code>IndexController:testAction()</code> through the URL like mysite.com/test. This allows us to not have to prefix the action with the controller like mysite.com/index/test. However, since the default route is there, that would still work and any other <code>:controller/:action</code> routes</li>
<li>We store our DB adapter in the registry so we can access it throughout our application</li>
<li>When we initialize our view helpers, we add the views/helpers directory to our helper path(s) and we setup some head information for our view/layout</li>
<li>The <code>AssetUrl</code> view helper will be explained in greater detail when I discuss caching &amp; CDN fronting your assets</li>
</ul>

<p>Now we are at a point where our application has been setup and is ready to process the request.</p>

<p>We&rsquo;ve covered a lot so far. There are a few things I didn&rsquo;t talk about, for example, how the <code>ErrorController.php</code> and <code>error.phtml</code> look, <code>AssetUrl.php</code>, or what the <code>layout.phtml</code> looks like. However, I have included a <a href="http://joegornick.com/wp-content/uploads/2009/11/zfbp-base1.zip">Zend Framework Best Practices - Base Directory Structure/Files</a> zip file containing the file structure and base files I&rsquo;ve discussed here.</p>

<p><strong>Update:</strong> I found two issues with the <code>application.ini</code> and <code>AssetUrl.php</code> files. They are now fixed and the post reflects the changes.</p>


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="https://joegornick.com/2007/07/24/wheres-the-prototype-framework-community/"><i class="fa fa-chevron-circle-left"></i> Where’s the Prototype Framework community?</a>
        </li>
        
        
        <li>
            <a href="https://joegornick.com/2009/12/02/zend-framework-best-practices-part-2-i18n/">Zend Framework Best Practices – Part 2: I18n <i class="fa fa-chevron-circle-right"></i> </a>
        </li>
        
    </ul>
</section>
    
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "jgornick" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    





</main>
    <footer>
        <h6>Copyright &copy; 2019 - Joe Gornick | 
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
            <a href="https://joegornick.com/index.xml">Subscribe</a></h6>
    </footer>
</div>
<script src="https://joegornick.com/js/scripts.js"></script>
</body>

</html>